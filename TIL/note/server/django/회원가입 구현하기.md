# 회원가입 구현하기

<br>

- 기본적인 작업
  - 가상환경, accounts 앱 생성, 세팅에 앱 등록, url 등록 등

---

1. `settings.py` 에 USER Model 정의
   - `AUTH_USER_MODEL = ["앱이름.[모델 이름]"]`
     - `AUTH_USER_MODEL = "accounts.User"`

2. `models.py` 에 유저 모델 클래스 정의

   ```python
    class [모델 이름](AbstractUser):
        pass
   ```

   - 원하는 모델 상속받기
     - 모델 상속 구조에 따라 필요한 단계만 추출해서 거기에 덧대서 사용하기도 하고,
       - 기본적으로 제공해주는 모델을 사용하려고 한다면 `AbstractUser` 를 상속받으면 된다.
     - `from django.contrib.auth.models import [상속받을 유저 모델]`

3. 마이그레이션, 마이그레이트

4. `urlpatterns` 에 가입 페이지 url 등록

5. `views.py` 에 signup 함수 정의

6. `forms.py` 에서 `UserCreationForm` 을 상속받는 새로운 폼을 만든다.

    ```python
    from django.contrib.auth.forms import UserCreationForm
    # from .models import [모델 이름]
    from django.contrib.auth import get_user_model
    
    
    class [새로운 모델 폼 이름](UserCreationForm):
        class Meta:
            model = get_user_model()
            fields = (["받아올 필드들"],)
    ```

    - `from .models import [모델 이름]` 으로 모델을 직접 적용하기보다는,
      - `from django.contrib.auth import get_user_model` 의 함수 형태로 불러오는 것이 권장된다.
    - 새로운 폼을 만들지 않고 진행하면 `UserCreationForm` 을 그대로 사용하게 되어,
      - `Manager isn't available ...` 오류가 발생한다.
      - 우리는 장고가 원래 제공하던 기본 유저 모델을 사용하지 않고 있기 때문이다.
        - 우리는 위의 1번 과정에서 `AUTH_USER_MODEL = "accounts.User"` 로 바꾸어주면서,
        - django 에게 기본 모델을 사용하지 않을것이라고 말했다.
      - 즉, 장고가 기본 제공하는 유저 모델을 사용하지 않고 우리가 커스텀 한 유저 모델을 사용해야 하기 때문에 직접 만들어주어야 한다.
        - `accounts.User` 라는 모델에 맞는 모델 폼을 만들어서 써야 한다.

7. `admin.py` 에도 `get_user_model` 등록하기

---

###### 우리가 상속을 받는 이유는 이미 구현되어 있는 다양하고 유용한 기능들을 다시 직접 구현하기 번거롭기 때문이다.

---

<br>

### 주요 질문들

<br>

Q. `accounts.User` 에 만들고, `AbstractUser` 를 상속받은 다음 pass 를 해서 '굳이' 빈 껍데기를 만들어서 사용하는 이유

- 즉, 기본 제공되는 `auth.User` 를 사용하지 않는 이유

A. 나중에 모델이 수정되는 경우를 대비해서 미리 모델 수정을 용이하게 만들어주는 사전 작업이다.

- 그냥 사용하게 되면 나중에 수정이 필요할 때 django 내부에 있는 것들을 수정해야 한다.
- 미리 바꿔두면 위 처럼 번거로운 작업 없이 `accounts.User` 에 대해서만 수정해서 가면 된다.
  - 설정 후에는 반드시 `AUTH_USER_MODEL` 을 바꿔주어야 적용된다.

<br>

Q. `UserCreationForm` 을 상속받아서 커스텀 하는 이유

A. 우리는 `AUTH_USER_MODEL` 의 수정을 통해 기본 유저 모델을 바꾸었다.

- 기본 유저 모델이 변경되었기 때문에 기본 모델 폼도 변경되었다.
- 변경된 유저 모델에 맞춰서 기본형인 `UserCreationForm` 을 상속받고 커스텀 유저 모델폼을 만들어야 한다.
  - `UserCreationForm` 은 `ModelForm` 을 상속받아서 만들고 있다.

<br>

Q. `get_user_model()` 을 사용하는 이유

A. 우리는 `AUTH_USER_MODEL` 의 수정을 통해 기본 유저 모델을 바꾸었다.

- 변경된 유저 모델을 번거로운 찾기 작업 없이 `get_user_model()` 라는 함수의 리턴값을 통하여 간단하게 불러올 수 있다.

<br>