# VPC 구성 전 선수지식

<br>

- VPC: Vitual Private Cloud

  - AWS는 원래 단일 네트워크이다.
  - 단일 네트워크의 내부에서 VPC를 구성하여 논리적으로 분리되어 있는 가상의 공간을 확보한다.
    - 외부에서 접속하려면 정해진 포트와 규칙으로만 접근이 가능하다.
- VPC의 구조

  1. VPC 내부에 AZ(Availability Zone)라는 물리적으로 분리된 데이터 센터가 존재한다.
     - 각 AZ는 물리적으로 독립되어 있어서 하나의 AZ에서 장애가 발생해도 다른 AZ에 영향을 주지 않는다.
  2. AZ 내부에 subnet을 구성한다.
     - subnet은 외부에서 바로 접근이 가능한 public subnet, 외부에서 바로 접근 불가능 하고 bastion server 등을 경유해서 접근할 수 있는 private subnet 두 종류를 만든다.
     - public subnet은 EC2와 연결하고 private subnet은 RDS와 연결하여 사용한다.
- CIDR: Classless Inter Domain Routing

  - IP를 표현하는 국제적인 표준이다.

  - VPC의 CIDR을 `10.0.0.0/16` 으로 설정한 경우 다음과 같은 의미를 가진다.

    - 슬래시뒤의 16이라는 숫자는 총 32비트로 구성되는 IP에서 앞의 16비트는 고정한다는 의미를 갖고 있다.

    - 즉, 뒤의 16비트로 다양한 IP를 구성할 수 있고 결과적으로 65536(2^16)개의 IP를 구성할 수 있다.

      - 이 VPC는 65536개의 private IP를 가질 수 있다.

    - 슬래시 뒤의 값은 16이 권장된다.

    - private IP를 설정할 때 RFC에서 권장하는 3가지 형식은 다음과 같다.

      1. `10.0.0.0` ~ `10.255.255.255` -> `10/8` prefix
      2. `172.16.0.0` ~ `172.31.255.255` -> `172.16/12` prefix
      3. `192.168.0.0` ~ `192.168.255.255` -> `192.168/16` prefix
    - 위의 범위 말고는 public IP로 사용되기 때문에 private IP와 public IP를 명확히 분리하기 위함이다.
- Internet gateway
   - VPC는 기본적으로 폐쇄된 환경이다.
   - 외부 통신을 하려면 Internet gateway를 만들어 외부와 소통할 수 있는 길을 만들어주어야 한다.
   - 특정 EC2 인스턴스에서 어떤 웹 어플리케이션이 서비스 중이라면 이 EC2 인스턴스는 Internet gateway를 통해 외부와 통신을 하게 된다.
- 인바운드, 아웃바운드
   - 인바운드는 외부에서 내부로 들어온다는 의미이다.
   - 아웃바운드는 내부에서 외부로 나간다는 의미이다.
- 보안 설정
   - NACLs: Network ACLs
      - 서브넷 단위로 적용되는 보안 규칙
      - Stateless 방식으로 인바운드 트래픽을 기억하지 않는다.
         - 인바운드와 아웃바운드 트래픽에 각각 규칙을 설정해주어야 한다.
   - SG: Security Groups
      - 지정한 EC2 인스턴스 또는 IP별로 적용되는 보안 규칙이다.
      - Safeful 방식으로 인바운드 트래픽을 기억한다.
         - 인바운드 트래픽이 허용되면 아웃바운드 트래픽은 자동적으로 허용된다.
- NAT Gateway
   - 아웃바운드 전용 게이트웨이
   - 외부에서는 서버에 직접 접근할 수 없게 한다.
   - 서버는 새로운 코드를 다운받는 등의 행위가 가능하다.