# 바람직한 멀티쓰레딩 구조

<br>

## 0. 목차

<br>

1. 개요
2. 쓰레드의 역사(==CPU의 역사)
3. 

<br>

## 1. 개요

<br>

- 출처
  - 이 문서는 아래 유튜브 영상을 참고하여 만들어짐.
    - [바람직한 멀티스레딩 구조](https://www.youtube.com/watch?v=M1e9nmmD3II&t=132s)
    - 제작자 : Pope Kim(유튜브 채널 : 포프TV)
- 의도
  - 이전의 하드웨어적 환경(절대적인 코어 수가 적었던 환경)을 기준으로 하는 멀티쓰레딩 방법론에 대하여 최신의 하드웨어적 환경을 기준으로 갱신하기 위함.

<br>

## 2. 쓰레드의 역사(==CPU의 역사)

<br>

- 예전(90년대 초반)에는 CPU가 하나인 환경이 절대 다수였음.

  1. 단일 Core 환경

  2. 이러한 환경에서도 멀티쓰레딩은 구현되어져 왔음.

     - 이유는 퍼포먼스적인 이유는 아니었음.

     - Non-Blocking 연산이 불가했기 때문임.
       - ==Block 되는 현상
         - 버튼을 누르고 응답이 올 때까지 모든 연산이 멈추는 현상
         - 채팅을 보내고 답장이 올 때까지 모든 동작이 멈추는 일
       - 즉 부드러운 사용자 경험을 위해(느린 퍼포먼스에도 불구하고) 사용되어 왔음.
     - 오버헤드의 발생
       - context switching으로 인한 오버헤드 발생
         - 변수 테이블 등의 갱신 작업 등
         - 메모리 맵, 레지스터 등에서 값의 save, load 작업으로 인하여 발생함.
     - 게임 업계의 경우
       - 2000년대 중반 이전
         - 오버헤드로 인한 성능 저하에도 불구하고 Non-blocking 작업만을 구현했음.
         - 오디오나 네트워킹 작업을 담당하는 쓰레드를 분리

- 2000년대 중반 이후

  1. 기존 CPU 설계 방식으로 도달할 수 있는 속도의 한계치에 도달

     - CPU 속도의 증가 폭이 완만해짐.

     - CPU 속도 증가폭이 완만해짐에 따라 게임 속도의 증가 폭도 완만해짐.

  2. CPU의 코어 수를 늘려서 속도가 두 배 빨라질 것 처럼 만들었음.

     - 그러나 여전히 기존의 아키텍쳐들은 1 Core 만을 사용하도록 설계되어 있었음.
       - Core 하나만 가지고 멀티쓰레딩을 구현
       - 즉 Core 수가 아무리 늘어나더라도 속도에는 차이가 없음.

  3. 위와 같은 이유들로 인하여 여러 코어를 사용하는 멀티쓰레딩 방식에 대해 본격적으로 연구되기 시작한 시기임.

     - 듀얼 코어 CPU의 경우

       - 양쪽의 코어에 작업을 분산시켜야 함.

       - 그런데 작업을 '어떻게' 잘라야 하는 것에 대한 기준이나 방법 등이 없었음.
       - 또한, 당시의 게임 엔진 구조도 갑작스레 바꿀 수는 없었음.

     - 해결책으로 update와 render(draw) 하는 부분을 분리함.

       - 이미 update와 render는 분리가 되어 있던 작업이었음.

       - 측정 결과, 당시 많은 CPU에서 update에 드는 시간과, 그렇게 처리된 자료를 모아서 그래픽카드에 넘겨주는 작업의 CPU 점유율이 절반씩 나왔음.

         - main thread에서 update를 담당하고, render thread에 그 자료들을 복사해서 넘겨줌.

         - render thread가 그리는 동안에 update thread는 다음 frame을 업데이트 하는 방식

     - 게임마다 두 작업의 비중이 상이하지만, 기본적으로는 의미 있는 성능 향상이 있었음.

       - 최소 20% 정도의 성능 향상이 있었음.

- 2006년 이후

  1. 2000년대 중반부터 듀얼 코어 이상의 CPU 제품군 출시
     - 2006년의 경우 i7 : 4 core + Hyper threading = 8 cores
     - 게임 엔진의 한계로 인해 늘어난 코어 수를 활용하지 못하는 몇몇 게임들이 존재하던 시기
     - 코어 개수가 늘어나면서 더욱 세분화된 multithreading 방식이 연구되던 시기임.
  2. 작업 단위로 분리하여 thread에 할당하는 방식의 한계를 맞이함.
     - PS3의 등장 초창기
       - 1 CPU + 7 SPU
       - 이 경우 기존의 방식(update와 render를 분리하는 방식)이 CPU 구조와 호환이 되지 않았기 때문에 적용이 불가하였음.
       - 당시 PS3 게임들의 퀄리티가 전반적으로 낮았던 이유가 여기에 있음(이러한 구조로 인한 최적화 & 비용 문제)
     - PS3 등장 이후
       - PS3가 시장에서 오랫동안 살아남으면서, 그러한 CPU 구조에 대한 이해가 생겨남.
       - 엄청난 수의 core를 온전히 활용할 수 있는 아키텍쳐를 만드려면 결국 새로운 multithreading 방식을 찾아야 한다는 결론에 도달함.
  3. 데이터 위주로 분리하여 thread에 할당하는 방식의 등장

- 